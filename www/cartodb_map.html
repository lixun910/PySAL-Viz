

<!DOCTYPE html>
<html>
<head>
<title>Leaflet example | CartoDB.js</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />
<style>
html, body, #map {
  height: 100%;
  padding: 0;
  margin: 0;
}
</style>
<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
<script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
<script src="js/jquery.min.js"></script>
<script>

var map;
$(document).ready(function() {

  //////////////////////////////////////////////////////////////
  // Create Theme/Themeless Maps
  //////////////////////////////////////////////////////////////
  var msg = window.opener.tempMsg,
      uuid = msg.uuid,
      title = msg.title,
      cartocss = msg.cartocss,
      vizjson = msg.vizjson,
      table_name = msg.table_name,
      layerDict = window.opener.layerDict;
  //window.opener.tempMsg = undefined;
  
  map = new L.Map('map', {
    center: [43, -98],
    zoom: 4
  });


  L.tileLayer('https://dnv9my2eseobd.cloudfront.net/v3/cartodb.map-4xtxp73f/{z}/{x}/{y}.png', {
        attribution: 'Mapbox <a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'
  }).addTo(map);

  var layerUrl = vizjson;
  
  var subLayerOptions = {
    query: "select nat.hr60, nat.the_geom, hr60_lisa.lisa from nat inner join hr60_lisa on nat.cartodb_id=hr60_lisa.cartodb_id",
    //cartocss: cartocss
    cartocss: "#nat [ lisa = '3' ] {polygon-fill:blue;} #hr60_lisa {polygon-fill:red;}"
  };
  

  cartodb.createLayer(map, {
          user_name: 'lixun910',
          type: 'cartodb',
          sublayers: [{
             sql: 'select a.the_geom_webmercator,a.cartodb_id,b.lisa from nat as a, hr60_lisa as b where a.cartodb_id=b.cartodb_id',
             cartocss: '#layer { polygon-fill: #F00; polygon-opacity: 0.3; line-color: #F00; } #layer[lisa="1"]{polygon-fill:blue;}',
             interactivity: 'cartodb_id'
          }]
        })
    .addTo(map)
    .on('done', function(layer) {
      cdb.vis.Vis.addInfowindow(map, layer.getSubLayer(0), ['lisa'])
    })
    .on('error', function() {
    });
});
</script>
</head>
<body>
<div id="map"></div>
</body>
</html>
